# Внимание!
Данная программа является прототипом и предоставляется в качестве примера. 
Она не является частью продукта ТестОпс. 
Применение, использование и поддержка полностью лежит на пользователе.

# Функционал
Программа проставляет воркфлоу и статусы автотестам в ТестОпс в соответствии с результатами прохождения.

# Логика работы
При закрытии запуска, ТестОпс отправляет вебхук на сервер фласк.
Фласк получает вебхук, парсит из него нужные данные, через API запрашивает недостающую информацию у ТестОпс. 
После чего несколькими API запросами меняет статусы автотестам в соответствии с результатами прохождения.

# Ограничения
1. Не настроена логика обработки тестов с параметрами.
2. Если переоткрыть запуск и потом опять его закрыть, то вся цепочка выполнится вновь.

# Шаги по использованию:
1. В файле flask_app.py укажите ваш инстанс в INSTANCE_NAME.
2. Создайте нужные статусы в интерфейсе ТестОпс.
   1. Запишите их названия и ID в файле functions.py в соответствующий словарь STATUSES. 
3. Создайте нужный воркфлоу в интерфейсе ТестОпс.
   1. Запишите его названия и ID в файле functions.py в соответствующий словарь WORKFLOW и его ID в WORKFLOW_ID. 
4. В файле functions.py в словаре RESULT_STATUSES укажите ID статусов для каждого из значений результатов.
5. Получите токен пользователя в интерфейсе ТестОпс.
6. Создайте в корневой папке программы файл .env и запишите в него свой токен в формате TESTOPS_TOKEN = "********-****-****-****-************"
7. В настройках проекта ТестОпс создайте новый Вебхук:
   1. Эндпоинт: http://<адрес вашего сервер фласк>:<порт вашего сервера фласк по умолчанию 5000>/webhook
   2. Триггер: Запуски -> Закрыт
   3. Тело запроса: {
"launch_name":"{{launchName}}",
"launch_url":"{{launchUrl}}",
"project_name":"{{projectName}}"
}
   4. Проверьте, что вебхук включен
8. Запустите фласк сервер (файл flask_app.py)
9. Все готово. Теперь при закрытии запуска с автотестами, им проставится нужный воркфлоу и статус в разделе тест-кейсы.